var U=Object.defineProperty;var _=(m,e,t)=>e in m?U(m,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[e]=t;var a=(m,e,t)=>_(m,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();class N{constructor(e){this.hedgehog=e}getName(){return"Unknown"}curl(){}uncurl(){}move(){return!0}isVulnerable(){return!1}canTalk(){return!1}}const S=class S extends N{getName(){return"Normal"}curl(){this.hedgehog.setState(new R(this.hedgehog))}move(){return S.ENERGY_COST}isVulnerable(){return!0}canTalk(){return!0}};a(S,"ENERGY_COST",1);let L=S;const w=class w extends N{getName(){return"Curled"}uncurl(){this.hedgehog.setState(new L(this.hedgehog))}move(){return w.ENERGY_COST}isVulnerable(){return!1}canTalk(){return!1}};a(w,"ENERGY_COST",2);let R=w;const b=class b extends N{getName(){return"Dead"}move(){return b.ENERGY_COST}isVulnerable(){return!1}canTalk(){return!1}};a(b,"ENERGY_COST",0);let O=b;const E=class E{constructor(e,t){this.positionX=e,this.positionY=t,this.energy=E.MAX_ENERGY,this.score=E.RESET_SCORE,this.state=new L(this)}setState(e){this.state=e}getStateName(){return this.state.getName()}curl(){this.state.curl()}uncurl(){this.state.uncurl()}move(e,t){const s=this.state.move();if(s!==E.MIN_ENERGY){if(this.energy<s){this.energy=E.MIN_ENERGY,this.die();return}this.positionX+=e,this.positionY+=t,this.consumeEnergy(s)}}consumeEnergy(e){this.energy-=e,this.energy<E.MIN_ENERGY&&(this.energy=E.MIN_ENERGY),this.energy===E.MIN_ENERGY&&this.die()}eat(e){this.energy+=e,this.energy>E.MAX_ENERGY&&(this.energy=E.MAX_ENERGY)}addScore(e){this.score+=e}die(){this.state=new O(this)}isAlive(){return!(this.state instanceof O)}isVulnerable(){return this.state.isVulnerable()}canTalk(){return this.state.canTalk()}getPosition(){return{x:this.positionX,y:this.positionY}}};a(E,"MAX_ENERGY",100),a(E,"MIN_ENERGY",0),a(E,"RESET_SCORE",0);let D=E;class x{static getDelta(e){return this.DIRECTION_DELTAS[e]||this.DIRECTION_DELTAS.right}}a(x,"DIRECTION_DELTAS",{up:{x:0,y:-1},down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0},north:{x:0,y:-1},south:{x:0,y:1},west:{x:-1,y:0},east:{x:1,y:0}}),a(x,"DIRECTIONS",["north","south","east","west"]);class H{constructor(e,t){this.width=e,this.height=t,this.pits=new Set,this.food=new Map,this.npcs=[],this.predators=[],this.bushes=new Map}isValidPosition(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height}addPit(e,t){this.pits.add(`${e},${t}`)}hasPit(e,t){return this.pits.has(`${e},${t}`)}addFood(e,t,s){this.food.set(`${e},${t}`,s)}hasFood(e,t){const s=`${e},${t}`;return this.food.has(s)}collectFood(e,t){const s=`${e},${t}`;if(this.food.has(s)){const i=this.food.get(s);return this.food.delete(s),i}return 0}getFoodInRadius(e,t,s){if(this.hasFood(e,t)&&!this.hasBush(e,t))return{x:e,y:t};for(let i=-s;i<=s;i+=1)for(let o=-s;o<=s;o+=1)if((i!==0||o!==0)&&Math.abs(i)+Math.abs(o)<=s){const n=e+i,h=t+o;if(this.hasFood(n,h)&&!this.hasBush(n,h))return{x:n,y:h}}return null}addNPC(e){this.npcs.push(e)}getNPCAt(e,t){return this.getNPCInRadius(e,t,1)}getNPCInRadius(e,t,s){let i=this.npcs.find(o=>o.positionX===e&&o.positionY===t);return i||(i=this.npcs.find(o=>Math.abs(o.positionX-e)+Math.abs(o.positionY-t)<=s)),i||null}addPredator(e){this.predators.push(e)}getPredatorAt(e,t){return this.predators.find(s=>s.positionX===e&&s.positionY===t)||null}getDirectionDelta(e){return x.getDelta(e)}getPredatorInFrontOf(e,t,s="right",i=10){const o=this.getDirectionDelta(s);for(let r=1;r<=i;r+=1){const n=e+o.x*r,h=t+o.y*r;if(!this.isValidPosition(n,h))break;const c=this.getPredatorAt(n,h);if(c)return c}return null}getAllPredatorsInDirection(e,t,s="right",i=10){const o=this.getDirectionDelta(s),r=[];for(let n=1;n<=i;n+=1){const h=e+o.x*n,c=t+o.y*n;if(!this.isValidPosition(h,c))break;const d=this.getPredatorAt(h,c);d&&r.push({predator:d,distance:n})}return r}getNearestPredator(e,t,s=15){let i=null,o=s+1;return this.predators.forEach(r=>{const n=Math.abs(r.positionX-e)+Math.abs(r.positionY-t);n<=s&&n<o&&(o=n,i=r)}),i}addBush(e,t,s=!1){this.bushes.set(`${e},${t}`,{hasFox:s})}hasBush(e,t){return this.bushes.has(`${e},${t}`)}getBush(e,t){return this.bushes.get(`${e},${t}`)||null}hasFoxBeforeBush(e,t,s,i){if(!this.hasBush(e,t))return!1;const o={x:e-s,y:t-i};let r,n;Math.abs(o.x)>Math.abs(o.y)?o.x>0?(r=e-1,n=t):(r=e+1,n=t):o.y>0?(r=e,n=t-1):(r=e,n=t+1);const h=this.npcs.find(d=>d.positionX===r&&d.positionY===n);return h&&h.name.includes("ü¶ä")&&h.name.includes("–õ–∏—Å–∏—Ü—è")}checkBushTrap(e,t){const s=this.getBush(e,t);return s&&s.hasFox}}const l=class l{constructor(e,t,s,i){this.name=e,this.strategy=t,this.positionX=s,this.positionY=i,this.dialogs=[]}giveAdvice(e,t){return this.strategy.giveAdvice(e,t)}addDialog(e){this.dialogs.push(e)}isDeceptiveStrategy(){return this.strategy.constructor.name===l.DECEPTIVE_STRATEGY_NAME}getDialog(e){return this.dialogs.length===0?`${this.name} has nothing to say.`:e.pick(this.dialogs)}getDeterministicValue(e){let t=e;return t=t*l.HASH_MULTIPLIER-t+e,t=Math.abs(t),t%l.HASH_MODULO}getNPCSeed(){return this.positionX*l.POSITION_MULTIPLIER+this.positionY}getFakePredatorWarning(e,t){const s=e.predators;if(s.length===0)return null;const i=this.getDeterministicValue(t+l.SEED_OFFSET_PREDATOR_INDEX)%s.length,o=s[i],r=this.getDeterministicValue(t+l.SEED_OFFSET_SHOULD_WARN)%l.BOOLEAN_CHOICE_DIVISOR===0;return{predator:o,shouldWarn:r,isTruthful:!1}}getPredatorWarning(e){const t=e.getNearestPredator(this.positionX,this.positionY,l.MAX_PREDATOR_DISTANCE),s=this.isDeceptiveStrategy(),i=this.getNPCSeed();if(!t)return s?this.getFakePredatorWarning(e,i):null;let o=!t.isFull;return s&&this.getDeterministicValue(i+l.SEED_OFFSET_SHOULD_LIE)%l.BOOLEAN_CHOICE_DIVISOR===0&&(o=!o),{predator:t,shouldWarn:o,isTruthful:o===!t.isFull}}getWarningMessages(e){return{warn:[`‚ö†Ô∏è –û–±–µ—Ä–µ–∂–Ω–æ! –ü–æ—Ä—É—á ${e}! –°–∫—Ä—É—Ç–∏—Å—å, —â–æ–± –Ω–µ –ø–æ–º–µ—Ä—Ç–∏!`,`ü¶Ö –°—Ç–µ—Ä–µ–∂–∏—Å—å ${e}! –í—ñ–Ω –Ω–µ–±–µ–∑–ø–µ—á–Ω–∏–π!`,`‚ö° ${e} —à—É–∫–∞—î —ó–∂—É! –ë—É–¥—å –æ–±–µ—Ä–µ–∂–Ω–∏–º!`],safe:[`üòä –í—Å–µ –¥–æ–±—Ä–µ! ${e} —Å–∏—Ç–∏–π, –Ω–µ –±—ñ–π—Å—è –π–æ–≥–æ!`,`‚úÖ ${e} –Ω–µ –Ω–µ–±–µ–∑–ø–µ—á–Ω–∏–π –∑–∞—Ä–∞–∑, –º–æ–∂–Ω–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç–∏!`,`üëç –ù–µ —Ö–≤–∏–ª—é–π—Å—è, ${e} –≤–∂–µ –Ω–∞—ó–≤—Å—è!`],noThreat:["üòä –í—Å–µ –¥–æ–±—Ä–µ! –ù–µ–º–∞—î –Ω–µ–±–µ–∑–ø–µ–∫–∏ –Ω–∞–≤–∫–æ–ª–æ!","‚úÖ –ú–æ–∂–Ω–∞ —Å–ø–æ–∫—ñ–π–Ω–æ –π—Ç–∏, —Ç—É—Ç –±–µ–∑–ø–µ—á–Ω–æ!","üëç –ù–µ —Ö–≤–∏–ª—é–π—Å—è, –≤—Å–µ –≥–∞—Ä–∞–∑–¥!"]}}getPredatorWarningMessage(e){const t=this.getPredatorWarning(e),s=this.isDeceptiveStrategy();if(!t&&!s)return null;if(!t&&s){const h=this.getNPCSeed(),c=this.getWarningMessages(null).noThreat,d=this.getDeterministicValue(h+l.SEED_OFFSET_NO_THREAT)%c.length;return{message:c[d],shouldCurl:!1,isWarning:!1,predator:null}}const i=this.getNPCSeed(),o=this.getWarningMessages(t.predator.name);if(t.shouldWarn){const h=s?i+l.SEED_OFFSET_WARN_DECEPTIVE:i+l.SEED_OFFSET_WARN_HONEST,c=this.getDeterministicValue(h)%o.warn.length;return{message:o.warn[c],shouldCurl:s?t.isTruthful:!0,isWarning:!0,predator:t.predator}}const r=s?i+l.SEED_OFFSET_SAFE_DECEPTIVE:i+l.SEED_OFFSET_SAFE_HONEST,n=this.getDeterministicValue(r)%o.safe.length;return{message:o.safe[n],shouldCurl:s?!t.isTruthful:!1,isWarning:!1,predator:t.predator}}getPosition(){return{x:this.positionX,y:this.positionY}}};a(l,"HASH_MODULO",1e3),a(l,"POSITION_MULTIPLIER",1e3),a(l,"HASH_MULTIPLIER",32),a(l,"BOOLEAN_CHOICE_DIVISOR",2),a(l,"SEED_OFFSET_PREDATOR_INDEX",1),a(l,"SEED_OFFSET_SHOULD_WARN",2),a(l,"SEED_OFFSET_SHOULD_LIE",3),a(l,"SEED_OFFSET_WARN_DECEPTIVE",10),a(l,"SEED_OFFSET_WARN_HONEST",11),a(l,"SEED_OFFSET_SAFE_DECEPTIVE",12),a(l,"SEED_OFFSET_SAFE_HONEST",13),a(l,"SEED_OFFSET_NO_THREAT",14),a(l,"MAX_PREDATOR_DISTANCE",15),a(l,"DECEPTIVE_STRATEGY_NAME","DeceptiveStrategy");let A=l;const f=class f{constructor(e,t,s,i=!1){this.name=e,this.positionX=t,this.positionY=s,this.isFull=i,this.startX=t,this.startY=s,this.direction=Math.random()>f.INITIAL_DIRECTION_CHANCE?1:-1,this.moveCounter=f.RESET_COUNTER}calculateManhattanDistance(e,t,s,i){return Math.abs(e-s)+Math.abs(t-i)}move(e){if(this.moveCounter+=1,this.moveCounter%f.MOVE_INTERVAL!==0)return;this.calculateManhattanDistance(this.positionX,this.positionY,this.startX,this.startY)>=f.MAX_DISTANCE_FROM_START&&(this.direction*=-1);const s=[{x:this.direction,y:0},{x:-this.direction,y:0}],i=s[Math.floor(Math.random()*s.length)],o=this.positionX+i.x,r=this.positionY+i.y;e.isValidPosition(o,r)&&this.calculateManhattanDistance(o,r,this.startX,this.startY)<=f.MAX_DISTANCE_FROM_START&&(this.positionX=o,this.positionY=r)}attack(e){return this.isFull?!1:e.isVulnerable()?(e.die(),!0):!1}getPosition(){return{x:this.positionX,y:this.positionY}}};a(f,"INITIAL_DIRECTION_CHANCE",.5),a(f,"MOVE_INTERVAL",10),a(f,"MAX_DISTANCE_FROM_START",10),a(f,"RESET_COUNTER",0);let P=f;class B{giveAdvice(e){return e}}class Y extends B{giveAdvice(e){return e}}const C=class C extends B{constructor(){super(),this.honestyRate=C.DEFAULT_HONESTY_RATE}giveAdvice(e,t){if(t.chance(this.honestyRate))return e;const s=x.DIRECTIONS.filter(i=>i!==e);return t.pick(s)}};a(C,"DEFAULT_HONESTY_RATE",.6);let M=C;const p=class p{constructor(){this.width=p.DEFAULT_WIDTH,this.height=p.DEFAULT_HEIGHT,this.pitsData=[],this.foodData=[],this.npcsData=[],this.predatorsData=[],this.bushesData=[]}setDimensions(e,t){return this.width=e,this.height=t,this}addPit(e,t){return this.pitsData.push({x:e,y:t}),this}addFood(e,t,s){return this.foodData.push({x:e,y:t,value:s}),this}addNPC(e,t,s,i,o=[]){return this.npcsData.push({name:e,type:t,x:s,y:i,dialogs:o}),this}addPredator(e,t,s){return this.predatorsData.push({name:e,x:t,y:s}),this}fromJSON(e){return this.width=e.width||p.DEFAULT_WIDTH,this.height=e.height||p.DEFAULT_HEIGHT,this.pitsData=e.pits||[],this.foodData=e.food||[],this.npcsData=e.npcs||[],this.predatorsData=e.predators||[],this.bushesData=e.bushes||[],this}createStrategy(e){return e===p.NPC_TYPE_HONEST?new Y:new M}build(){const e=new H(this.width,this.height);return this.pitsData.forEach(t=>{e.addPit(t.x,t.y)}),this.foodData.forEach(t=>{e.addFood(t.x,t.y,t.value)}),this.npcsData.forEach(t=>{const s=this.createStrategy(t.type),i=new A(t.name,s,t.x,t.y);t.dialogs.forEach(o=>i.addDialog(o)),e.addNPC(i)}),this.predatorsData.forEach(t=>{const s=new P(t.name,t.x,t.y);e.addPredator(s)}),this.bushesData.forEach(t=>{e.addBush(t.x,t.y,t.hasFox||!1)}),e}};a(p,"DEFAULT_WIDTH",10),a(p,"DEFAULT_HEIGHT",10),a(p,"NPC_TYPE_HONEST","honest"),a(p,"NPC_TYPE_DECEPTIVE","deceptive");let I=p;class X{constructor(){this.events={}}on(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}off(e,t){this.events[e]&&(this.events[e]=this.events[e].filter(s=>s!==t))}emit(e,...t){this.events[e]&&this.events[e].forEach(s=>{s(...t)})}clear(){this.events={}}}const V="north",u=class u{constructor(e,t,s=u.DEFAULT_MAX_TIME){this.rng=t,this.eventBus=new X,this.maxTime=s;const i=new I;this.world=i.fromJSON(e).build(),this.hedgehog=new D(u.DEFAULT_START_X,u.DEFAULT_START_Y),this.timeRemaining=s,this.gameOverFlag=!1,this.curledMoveCounter=u.RESET_COUNTER,this.lives=u.DEFAULT_LIVES}moveHedgehog(e){if(this.isGameOver())return;const t=x.getDelta(e),s=this.hedgehog.positionX+t.x,i=this.hedgehog.positionY+t.y;if(!this.world.isValidPosition(s,i)){this.eventBus.emit("invalidMove",{direction:e});return}if(!this.hedgehog.isVulnerable()){if(this.curledMoveCounter+=1,this.curledMoveCounter%u.CURLED_MOVE_INTERVAL!==0)return;this.curledMoveCounter=u.RESET_COUNTER}else this.curledMoveCounter=u.RESET_COUNTER;this.isGameOver()||(this.hedgehog.move(t.x,t.y),this.decreaseTime(),!this.isGameOver()&&(this.checkDangerOnPosition()||this.checkPosition()))}checkDangerOnPosition(){const e=this.getHedgehogPosition(),t=this.hedgehog.isVulnerable();return this.checkPredatorDanger(e,t)?!0:this.checkBushTrap(e,t)}checkPredatorDanger(e,t){const s=this.world.getPredatorAt(e.x,e.y);return s&&t&&!s.isFull?(this.hedgehog.die(),this.eventBus.emit("predatorDeath",this.createPositionEventData({predator:s.name})),!0):!1}checkBushTrap(e,t){if(this.world.hasBush(e.x,e.y)){const s=this.world.getBush(e.x,e.y);if(s&&s.hasFox){if(t)return this.hedgehog.die(),this.eventBus.emit("bushTrapDeath",this.createPositionEventData()),!0;this.eventBus.emit("bushSurvived",this.createPositionEventData())}}return!1}getHedgehogPosition(){return{x:this.hedgehog.positionX,y:this.hedgehog.positionY}}createPositionEventData(e={}){const t=this.getHedgehogPosition();return{...e,positionX:t.x,positionY:t.y}}checkPosition(){const e=this.getHedgehogPosition();this.collectFood(),this.world.hasPit(e.x,e.y)&&this.handlePit()}handlePit(){this.rng.chance(u.PIT_SURVIVAL_CHANCE)?this.eventBus.emit("pitSurvived",this.createPositionEventData()):(this.hedgehog.die(),this.eventBus.emit("pitDeath",this.createPositionEventData()))}handlePredator(e){e.attack(this.hedgehog)?this.eventBus.emit("predatorDeath",this.createPositionEventData({predator:e.name})):this.eventBus.emit("predatorSurvived",this.createPositionEventData({predator:e.name}))}collectFood(){if(!this.hedgehog.canTalk())return!1;const e=this.getHedgehogPosition(),t=this.world.getFoodInRadius(e.x,e.y,1);if(t){const s=this.world.collectFood(t.x,t.y);return this.hedgehog.eat(s),this.hedgehog.addScore(s),this.eventBus.emit("foodCollected",{value:s,positionX:t.x,positionY:t.y}),!0}return!1}talkToNPC(){if(!this.hedgehog.canTalk())return null;const e=this.getHedgehogPosition(),t=this.world.getNPCInRadius(e.x,e.y,1);if(!t)return null;const s=t.getDialog(this.rng),i=t.giveAdvice(V,this.rng),o=t.getPredatorWarningMessage(this.world),r={npc:t.name,dialog:o?o.message:s,advice:i,warning:o};return this.eventBus.emit("npcTalk",r),r}curlHedgehog(){this.hedgehog.curl(),this.eventBus.emit("hedgehogCurl",{})}uncurlHedgehog(){this.hedgehog.uncurl(),this.eventBus.emit("hedgehogUncurl",{})}decreaseTime(){this.timeRemaining-=1,this.timeRemaining<=0&&(this.gameOverFlag=!0,this.eventBus.emit("timeOut",{}))}isGameOver(){return this.gameOverFlag||!this.hedgehog.isAlive()}getGameState(){return{hedgehog:{position:this.hedgehog.getPosition(),energy:this.hedgehog.energy,score:this.hedgehog.score,state:this.hedgehog.getStateName()},timeRemaining:this.timeRemaining,isGameOver:this.isGameOver(),lives:this.lives}}restart(e){const t=new I;this.world=t.fromJSON(e).build(),this.hedgehog=new D(u.DEFAULT_START_X,u.DEFAULT_START_Y),this.timeRemaining=this.maxTime,this.gameOverFlag=!1,this.curledMoveCounter=u.RESET_COUNTER}};a(u,"PIT_SURVIVAL_CHANCE",.5),a(u,"CURLED_MOVE_INTERVAL",2),a(u,"DEFAULT_MAX_TIME",100),a(u,"DEFAULT_LIVES",5),a(u,"DEFAULT_START_X",0),a(u,"DEFAULT_START_Y",0),a(u,"RESET_COUNTER",0);let k=u;class G{constructor(){this.elements={state:document.getElementById("state"),energy:document.getElementById("energy"),score:document.getElementById("score"),time:document.getElementById("time"),log:document.getElementById("log")}}render(e){this.updateInfo(e)}updateInfo(e){const{hedgehog:t,timeRemaining:s}=e;if(this.elements.state){const i={Normal:"ü¶î",Curled:"üîµ",Dead:"üíÄ"};this.elements.state.textContent=`${i[t.state]||""} ${t.state}`}this.elements.energy&&(this.elements.energy.textContent=t.energy),this.elements.score&&(this.elements.score.textContent=t.score),this.elements.time&&(this.elements.time.textContent=s)}addLog(e,t="info"){if(!this.elements.log)return;const s=new Date().toLocaleTimeString(),i=document.createElement("div");i.className=`log-entry ${t}`,i.textContent=`[${s}] ${e}`,this.elements.log.appendChild(i),this.elements.log.scrollTop=this.elements.log.scrollHeight}clearLog(){this.elements.log&&(this.elements.log.innerHTML="")}disableButtons(e){e.forEach(t=>{t&&(t.disabled=!0)})}enableButtons(e){e.forEach(t=>{t&&(t.disabled=!1)})}}const v=class v{constructor(e=Date.now()){this.seed=e}next(){return this.seed=(this.seed*v.MULTIPLIER+v.INCREMENT)%v.MODULUS,this.seed/v.MODULUS}chance(e){return this.next()<e}nextInt(e,t){return Math.floor(this.next()*(t-e+1))+e}pick(e){const t=this.nextInt(0,e.length-1);return e[t]}};a(v,"MULTIPLIER",9301),a(v,"INCREMENT",49297),a(v,"MODULUS",233280);let j=v;const W=100,z=10,J=[{x:5,y:3},{x:12,y:5},{x:18,y:2},{x:25,y:8},{x:32,y:4},{x:38,y:6},{x:44,y:3}],K=[{x:3,y:0,value:40,emoji:"üçé"},{x:8,y:0,value:40,emoji:"üçé"},{x:11,y:0,value:50,emoji:"üçÑ"},{x:15,y:0,value:60,emoji:"ü•ï"},{x:18,y:0,value:45,emoji:"üçì"},{x:22,y:0,value:50,emoji:"üçÑ"},{x:25,y:0,value:70,emoji:"üå∞"},{x:28,y:0,value:55,emoji:"üçí"},{x:33,y:0,value:45,emoji:"üçì"},{x:36,y:0,value:60,emoji:"üçä"},{x:39,y:0,value:55,emoji:"üçí"},{x:42,y:0,value:65,emoji:"üçá"},{x:46,y:0,value:65,emoji:"üçá"},{x:49,y:0,value:50,emoji:"ü•ù"},{x:52,y:0,value:50,emoji:"ü•ù"},{x:55,y:0,value:60,emoji:"üçä"},{x:58,y:0,value:60,emoji:"üçä"},{x:61,y:0,value:55,emoji:"üçë"},{x:64,y:0,value:55,emoji:"üçë"},{x:67,y:0,value:65,emoji:"ü•≠"},{x:70,y:0,value:65,emoji:"ü•≠"},{x:73,y:0,value:60,emoji:"üçã"},{x:76,y:0,value:60,emoji:"üçã"},{x:79,y:0,value:70,emoji:"üçê"},{x:82,y:0,value:70,emoji:"üçê"},{x:85,y:0,value:55,emoji:"üçå"},{x:88,y:0,value:55,emoji:"üçå"},{x:91,y:0,value:65,emoji:"üçâ"},{x:94,y:0,value:65,emoji:"üçâ"},{x:97,y:0,value:60,emoji:"üçé"}],q=[{name:"üê∞ –ó–∞–π—á–∏–∫",type:"honest",x:3,y:1,emoji:"üê∞",dialogs:["–ü—Ä–∏–≤—ñ—Ç! –Ø –ó–∞–π—á–∏–∫.","–û–±–µ—Ä–µ–∂–Ω–æ, —Ç—É—Ç —î –ø–∞—Å—Ç–∫–∏.","–®—É–∫–∞–π —ó–∂—É, –≤–æ–Ω–∞ –¥–æ–ø–æ–º–æ–∂–µ."]},{name:"ü¶ä –õ–∏—Å–∏—Ü—è",type:"deceptive",x:6,y:0,emoji:"ü¶ä",dialogs:["–•–º, —ó–∂–∞—á–æ–∫...","–•–æ—á–µ—à –ø–æ—Ä–∞–¥—É? –•–µ-—Ö–µ...","–ú–æ–∂—É –æ–±–º–∞–Ω—É—Ç–∏, –∞ –º–æ–∂—É –Ω—ñ.","–î–æ–≤—ñ—Ä—è–π –º–µ–Ω—ñ –Ω–∞ —Å–≤—ñ–π —Ä–∏–∑–∏–∫!"]},{name:"üê¶ –ü—Ç–∞—à–∫–∞",type:"honest",x:12,y:1,emoji:"üê¶",dialogs:["–ß—ñ—Ä—ñ–∫-—á—ñ—Ä—ñ–∫!","–Ø –±–∞—á—É –≤—Å–µ –∑–≤–µ—Ä—Ö—É!","–á–∂–∞ –Ω–∞ –ø—ñ–≤–¥–Ω—ñ, –¥—Ä—É–∂–µ!","–õ–µ—Ç–∞–π –¥—É–º–∫–∞–º–∏!"]}],Q=[{name:"üê∫ –í–æ–≤–∫",x:19,y:0,emoji:"üê∫"},{name:"üêª –í–µ–¥–º—ñ–¥—å",x:30,y:0,emoji:"üêª"},{name:"ü¶ä –í–æ–≤–∫-2",x:43,y:0,emoji:"üê∫"},{name:"üêª –í–µ–¥–º—ñ–¥—å-2",x:49,y:0,emoji:"üêª"},{name:"üê∫ –í–æ–≤–∫-3",x:61,y:0,emoji:"üê∫"},{name:"üêª –í–µ–¥–º—ñ–¥—å-3",x:67,y:0,emoji:"üêª"},{name:"üê∫ –í–æ–≤–∫-4",x:79,y:0,emoji:"üê∫"},{name:"üêª –í–µ–¥–º—ñ–¥—å-4",x:85,y:0,emoji:"üêª"}],Z=[{x:7,y:0,hasFox:!0},{x:20,y:0,hasFox:!0},{x:14,y:0,hasFox:!1},{x:28,y:0,hasFox:!1},{x:40,y:0,hasFox:!1}],y={width:W,height:z,pits:J,food:K,npcs:q,predators:Q,bushes:Z};class ee{constructor(e,t){this.hedgehogEl=document.getElementById("hedgehog"),this.animationLayer=document.getElementById("animation-layer"),this.energyFill=document.getElementById("energy-fill"),this.chatContainer=document.getElementById("chat-container"),this.objectsLayer=document.getElementById("objects-layer"),this.worldTrack=document.getElementById("world-track"),this.worldDecorations=document.getElementById("world-decorations"),this.livesEl=document.getElementById("lives"),this.currentObjects=new Map,this.mapWidth=e,this.mapHeight=t,this.cellSize=120,this.worldWidth=1e5,this.worldTrack.style.width=`${this.worldWidth}px`,this.initializeDecorations(),this.initializeHedgehog()}initializeDecorations(){this.worldDecorations.innerHTML="";const e=["üå≤","üå≥"],t=["üåø","üçÑ","üå∏","ü™®"];for(let s=0;s<this.worldWidth/80;s+=1){const i=Math.random()>.4,o=i?e[Math.floor(Math.random()*e.length)]:t[Math.floor(Math.random()*t.length)],r=document.createElement("div");r.textContent=o;const n=i?45+Math.random()*25:25+Math.random()*15,h=s*80+Math.random()*60,c=i?70+Math.random()*30:82+Math.random()*8;r.style.cssText=`
        position: absolute;
        font-size: ${n}px;
        left: ${h}px;
        bottom: ${c}px;
        opacity: ${i?.7:.5};
        z-index: ${i?1:0};
      `,this.worldDecorations.appendChild(r)}}initializeObjects(e){this.objectsLayer.innerHTML="",this.currentObjects.clear(),e.world.food.forEach((t,s)=>{const[i,o]=s.split(",").map(Number),r=y.food.find(n=>n.x===i&&n.y===o);this.addObject(i,o,s,(r==null?void 0:r.emoji)||"üçé","food")}),e.world.npcs.forEach(t=>{const s=`${t.positionX},${t.positionY}`,i=y.npcs.find(o=>o.x===t.positionX&&o.y===t.positionY);this.addObject(t.positionX,t.positionY,s,(i==null?void 0:i.emoji)||"üê∞","npc")}),e.world.predators.forEach(t=>{const s=`${t.positionX},${t.positionY}`,i=y.predators.find(r=>r.x===t.positionX&&r.y===t.positionY);this.addObject(t.positionX,t.positionY,s,(i==null?void 0:i.emoji)||"üê∫","predator");const o=this.currentObjects.get(s);o&&o.classList.contains("predator")&&(o.dataset.predatorName=t.name)}),e.world.bushes.forEach((t,s)=>{const[i,o]=s.split(",").map(Number);this.addObject(i,o,s,"üåø","bush")})}addObject(e,t,s,i,o){const r=document.createElement("div");r.className=`game-object ${o}`,r.textContent=i,r.dataset.key=s,r.dataset.gridX=e,r.dataset.gridY=t,r.title=`${i} ${o} (${e},${t})`;const n=e*this.cellSize,c=24+t*30;let d=40;o==="food"?d=35:o==="npc"?d=50:o==="predator"?d=55:o==="bush"&&(d=45),r.style.cssText=`
      position: absolute;
      left: ${n}px;
      bottom: ${c}px;
      font-size: ${d}px;
      z-index: 15;
      pointer-events: auto;
      cursor: pointer;
      filter: drop-shadow(0 2px 5px rgba(0, 0, 0, 0.8));
    `,this.objectsLayer.appendChild(r),this.currentObjects.set(s,r)}updateWorldPosition(e){const t=-e*this.cellSize;this.worldTrack.style.transform=`translateX(${t}px)`}updatePredatorPositions(e){const t=new Set(e.predators.map(i=>i.name));e.predators.forEach(i=>{const o=`${i.positionX},${i.positionY}`,n=Array.from(this.currentObjects.entries()).find(([,h])=>h.classList.contains("predator")&&h.dataset.predatorName===i.name);if(n){const[h,c]=n;h!==o&&(this.currentObjects.delete(h),this.currentObjects.set(o,c));const d=i.positionX*this.cellSize,g=24+i.positionY*30;c.style.left=`${d}px`,c.style.bottom=`${g}px`}else{const h=y.predators.find(d=>d.name===i.name);this.addObject(i.positionX,i.positionY,o,(h==null?void 0:h.emoji)||"üê∫","predator");const c=this.currentObjects.get(o);c&&(c.dataset.predatorName=i.name)}}),Array.from(this.currentObjects.entries()).filter(([,i])=>i.classList.contains("predator")&&!t.has(i.dataset.predatorName)).forEach(([i,o])=>{this.currentObjects.delete(i),o.remove()})}syncFoodObjects(e){const t=new Set(e.food.keys());Array.from(this.currentObjects.entries()).filter(([i,o])=>o.classList.contains("food")&&!t.has(i)).forEach(([i,o])=>{this.currentObjects.delete(i),o.remove()})}removeObject(e,t,s=!0){const i=`${e},${t}`,o=this.currentObjects.get(i);o&&(s?(o.classList.add("collected"),setTimeout(()=>{o.remove(),this.currentObjects.delete(i)},600)):(o.remove(),this.currentObjects.delete(i)))}showChat(e,t,s=null){this.clearChat();const i=document.createElement("div");i.className=`chat-message ${e}`,i.textContent=t,s&&(i.dataset.name=s),this.chatContainer.appendChild(i),setTimeout(()=>this.clearChat(),8e3)}clearChat(){this.chatContainer.innerHTML=""}animateWalk(){this.hedgehogEl.classList.contains("curled")||(this.hedgehogEl.classList.remove("walk","jump","fall"),this.hedgehogEl.classList.add("walk"),setTimeout(()=>this.hedgehogEl.classList.remove("walk"),500))}animateBounce(){this.hedgehogEl.classList.remove("walk","jump","fall","bounce"),this.hedgehogEl.classList.add("bounce"),setTimeout(()=>this.hedgehogEl.classList.remove("bounce"),300)}setHedgehogDirection(e){this.lastDirection=e}initializeHedgehog(){this.hedgehogEl.classList.add("facing-right"),this.hedgehogEl.style.transform="translateX(-50%) scaleX(-1)",this.lastDirection="right"}animateJump(){this.hedgehogEl.classList.remove("walk","jump","fall"),this.hedgehogEl.classList.add("jump"),this.createParticles("‚≠ê",5),setTimeout(()=>this.hedgehogEl.classList.remove("jump"),600)}animateFall(){this.hedgehogEl.classList.remove("walk","jump","fall"),this.hedgehogEl.classList.add("fall"),this.createParticles("üíÄ",3)}updateCurledState(e){e?this.hedgehogEl.classList.add("curled"):(this.hedgehogEl.classList.remove("curled"),this.hedgehogEl.classList.remove("facing-left"),this.hedgehogEl.classList.add("facing-right"),this.hedgehogEl.style.transform="translateX(-50%) scaleX(-1)")}createParticles(e,t){const s=this.hedgehogEl.getBoundingClientRect(),i=this.animationLayer.getBoundingClientRect();for(let o=0;o<t;o+=1){const r=document.createElement("div");r.className="particle",r.textContent=e;const n=Math.PI*2*o/t,h=50+Math.random()*50,c=Math.cos(n)*h,d=Math.sin(n)*h;r.style.left=`${s.left-i.left+s.width/2}px`,r.style.top=`${s.top-i.top+s.height/2}px`,r.style.setProperty("--tx",`${c}px`),r.style.setProperty("--ty",`${d}px`),this.animationLayer.appendChild(r),setTimeout(()=>r.remove(),1e3)}}updateEnergyBar(e){this.energyFill.style.width=`${e}%`,this.energyFill.classList.remove("high","medium","low"),e>70?this.energyFill.classList.add("high"):e>30?this.energyFill.classList.add("medium"):this.energyFill.classList.add("low")}updateLives(e){this.livesEl&&(this.livesEl.textContent=e)}showGameOver(e){const t=document.createElement("div");t.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    `;const s=document.createElement("div");s.style.cssText=`
      background: white;
      padding: 40px;
      border-radius: 20px;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      animation: scaleIn 0.5s ease;
    `,s.innerHTML=`
      <h2 style="font-size: 2em; margin-bottom: 20px; color: #333;">${e}</h2>
      <p style="font-size: 1.2em; color: #666; margin-bottom: 30px;">
        –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å '–ù–æ–≤–∞ –≥—Ä–∞' —â–æ–± —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ —â–µ —Ä–∞–∑
      </p>
    `,t.appendChild(s),document.body.appendChild(t);const i=document.createElement("style");i.textContent=`
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      @keyframes scaleIn {
        from { transform: scale(0.5); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
      }
    `,document.head.appendChild(i),setTimeout(()=>{t.remove(),i.remove()},5e3)}}class te{constructor(){this.rng=new j,this.controller=new k(y,this.rng,200),this.renderer=new G,this.ui=new ee(y.width,y.height),this.predatorMoveInterval=null,this.setupEventListeners(),this.setupGameEvents(),this.ui.initializeObjects(this.controller),this.ui.updateWorldPosition(this.controller.hedgehog.positionX,this.controller.hedgehog.positionY),this.updateUI(),this.startPredatorMovement(),this.renderer.addLog("üéÆ –ì—Ä–∞ —Ä–æ–∑–ø–æ—á–∞–ª–∞—Å—è! –î–æ—Å–ª—ñ–¥—ñ—Ç—å –ª—ñ—Å.","success"),this.renderer.addLog(`ü¶î –£ –≤–∞—Å —î ${this.controller.lives} –∂–∏—Ç—Ç—ñ–≤.`,"info")}startPredatorMovement(){this.predatorMoveInterval=setInterval(()=>{this.controller.isGameOver()||(this.controller.world.predators.forEach(e=>{e.move(this.controller.world)}),this.updateUI())},500)}stopPredatorMovement(){this.predatorMoveInterval&&(clearInterval(this.predatorMoveInterval),this.predatorMoveInterval=null)}setupEventListeners(){var i,o,r,n,h,c,d,F;const e={up:document.getElementById("btn-up"),down:document.getElementById("btn-down"),left:document.getElementById("btn-left"),right:document.getElementById("btn-right"),talk:document.getElementById("btn-talk"),curl:document.getElementById("btn-curl"),uncurl:document.getElementById("btn-uncurl"),restart:document.getElementById("btn-restart")};(i=e.up)==null||i.addEventListener("click",()=>this.handleMove("up")),(o=e.down)==null||o.addEventListener("click",()=>this.handleMove("down")),(r=e.left)==null||r.addEventListener("click",()=>this.handleMove("left")),(n=e.right)==null||n.addEventListener("click",()=>this.handleMove("right")),(h=e.talk)==null||h.addEventListener("click",()=>this.handleTalk()),(c=e.curl)==null||c.addEventListener("click",()=>this.handleCurl()),(d=e.uncurl)==null||d.addEventListener("click",()=>this.handleUncurl()),(F=e.restart)==null||F.addEventListener("click",()=>this.handleRestart()),document.addEventListener("keydown",g=>{if(this.controller.isGameOver())return;if(g.key==="s"||g.key==="S"||g.key==="ArrowDown"){g.preventDefault(),this.handleCollectFood();return}const $={ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right",w:"up",a:"left",d:"right"}[g.key];$&&(g.preventDefault(),this.handleMove($)),(g.key==="t"||g.key==="T")&&this.handleTalk()});let t=0,s=0;document.addEventListener("keydown",g=>{if(this.controller.isGameOver())return;const T=Date.now();(g.key==="ArrowDown"||g.key==="s"||g.key==="S")&&(T-t<300?(this.handleCurl(),g.preventDefault(),t=0):t=T),(g.key==="ArrowUp"||g.key==="w"||g.key==="W")&&(T-s<300?(this.handleUncurl(),g.preventDefault(),s=0):s=T)})}setupGameEvents(){this.controller.eventBus.on("invalidMove",()=>{this.renderer.addLog("‚õî –ù–µ –º–æ–∂–Ω–∞ –≤–∏–π—Ç–∏ –∑–∞ –º–µ–∂—ñ –ª—ñ—Å—É!","error")}),this.controller.eventBus.on("foodCollected",e=>{this.ui.animateJump(),this.ui.removeObject(e.positionX,e.positionY,!0),this.renderer.addLog(`üçé –ó–Ω–∞–π–¥–µ–Ω–æ —ó–∂—É! +${e.value} –µ–Ω–µ—Ä–≥—ñ—ó, +${e.value} –æ—á–æ–∫`,"success")}),this.controller.eventBus.on("pitSurvived",()=>{this.ui.animateWalk(),this.renderer.addLog("üò∞ –í–∏ –≤–ø–∞–ª–∏ –≤ –ø–∞—Å—Ç–∫—É, –∞–ª–µ –∑–º–æ–≥–ª–∏ –≤–∏–±—Ä–∞—Ç–∏—Å—è!","info")}),this.controller.eventBus.on("pitDeath",()=>{this.ui.animateFall(),this.renderer.addLog("üíÄ –í–∏ –≤–ø–∞–ª–∏ –≤ –ø–∞—Å—Ç–∫—É —ñ –∑–∞–≥–∏–Ω—É–ª–∏...","error"),setTimeout(()=>this.handleGameOver(!0),1e3)}),this.controller.eventBus.on("predatorDeath",e=>{this.ui.animateFall(),this.renderer.addLog(`üê∫ ${e.predator} –Ω–∞–ø–∞–≤ –Ω–∞ –≤–∞—Å! –í–∏ –∑–∞–≥–∏–Ω—É–ª–∏...`,"error"),setTimeout(()=>this.handleGameOver(!0),1e3)}),this.controller.eventBus.on("predatorSurvived",e=>{this.ui.animateWalk(),this.renderer.addLog(`üõ°Ô∏è ${e.predator} –Ω–µ –∑–º—ñ–≥ –≤–∞—Å –∞—Ç–∞–∫—É–≤–∞—Ç–∏, –±–æ –≤–∏ —É –∫–ª—É–±–∫—É!`,"success")}),this.controller.eventBus.on("npcTalk",e=>{this.ui.showChat(e.npc,e.dialog,"–î—è–∫—É—é –∑–∞ –ø–æ—Ä–∞–¥—É!"),e.warning?e.warning.isWarning?this.renderer.addLog(`‚ö†Ô∏è ${e.npc}: '${e.dialog}'`,"error"):this.renderer.addLog(`üí¨ ${e.npc}: '${e.dialog}'`,"success"):this.renderer.addLog(`üí¨ ${e.npc}: '${e.dialog}'`,"info")}),this.controller.eventBus.on("hedgehogCurl",()=>{this.ui.updateCurledState(!0),this.renderer.addLog("üîµ –í–∏ –∑–≥–æ—Ä–Ω—É–ª–∏—Å—è –≤ –∫–ª—É–±–æ–∫.","info")}),this.controller.eventBus.on("hedgehogUncurl",()=>{this.ui.updateCurledState(!1),this.renderer.addLog("üî¥ –í–∏ —Ä–æ–∑–≥–æ—Ä–Ω—É–ª–∏—Å—è.","info")}),this.controller.eventBus.on("bushSurvived",()=>{this.ui.animateWalk(),this.renderer.addLog("üõ°Ô∏è –í–∏ —Å–∫—Ä—É—Ç–∏–ª–∏—Å—å —ñ –±–µ–∑–ø–µ—á–Ω–æ –ø—Ä–æ–π—à–ª–∏ —á–µ—Ä–µ–∑ –∫—É—â –∑ –ø–∞—Å—Ç–∫–æ—é –ª–∏—Å–∏—Ü—ñ!","success")}),this.controller.eventBus.on("bushTrapDeath",()=>{this.ui.animateFall(),this.renderer.addLog("ü¶ä –í–∏ –ø–æ—Ç—Ä–∞–ø–∏–ª–∏ –≤ –ø–∞—Å—Ç–∫—É –ª–∏—Å–∏—Ü—ñ –≤ –∫—É—â—ñ! –í–∏ –∑–∞–≥–∏–Ω—É–ª–∏...","error"),setTimeout(()=>this.handleGameOver(!0),1e3)}),this.controller.eventBus.on("timeOut",()=>{this.renderer.addLog("‚è±Ô∏è –ß–∞—Å –≤–∏–π—à–æ–≤! –ì—Ä—É –∑–∞–≤–µ—Ä—à–µ–Ω–æ.","error"),setTimeout(()=>this.handleGameOver(!1),500)}),this.controller.eventBus.on("gameRestart",()=>{this.renderer.clearLog(),this.ui.hedgehogEl.classList.remove("walk","jump","fall","curled"),this.ui.updateCurledState(!1),this.ui.clearChat(),this.ui.initializeDecorations(),this.ui.initializeObjects(this.controller),this.ui.initializeHedgehog(),this.renderer.addLog("üîÑ –ù–æ–≤–∞ –≥—Ä–∞ —Ä–æ–∑–ø–æ—á–∞–ª–∞—Å—è!","success")})}handleMove(e){this.controller.isGameOver()||(!this.controller.hedgehog.isVulnerable()||this.ui.animateBounce(),this.controller.moveHedgehog(e),this.controller.isGameOver())||(this.ui.updateWorldPosition(this.controller.hedgehog.positionX,this.controller.hedgehog.positionY),this.updateUI(),this.checkWinCondition(),this.checkCurrentPosition())}checkCurrentPosition(){const{positionX:e,positionY:t}=this.controller.hedgehog,s=this.controller.world.getNPCInRadius(e,t,1);s&&this.renderer.addLog(`üëã –í–∏ –±—ñ–ª—è ${s.name}. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å T —â–æ–± –ø–æ–≥–æ–≤–æ—Ä–∏—Ç–∏.`,"info"),this.controller.world.getFoodInRadius(e,t,1)&&this.renderer.addLog("üçé –ü–æ—Ä—É—á —î —ó–∂–∞! –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å S —â–æ–± –∑—ñ–±—Ä–∞—Ç–∏.","info");const o=this.controller.world.getPredatorAt(e,t);o&&(this.controller.hedgehog.isVulnerable()?this.renderer.addLog(`‚ö†Ô∏è –û–±–µ—Ä–µ–∂–Ω–æ! –ü–æ—Ä—É—á ${o.name}! –ó–≥–æ—Ä–Ω—ñ—Ç—å—Å—è (C) —â–æ–± –∑–∞—Ö–∏—Å—Ç–∏—Ç–∏—Å—è!`,"error"):this.renderer.addLog(`üõ°Ô∏è –ü–æ—Ä—É—á ${o.name}, –∞–ª–µ –≤–∏ —É –∫–ª—É–±–∫—É - –±–µ–∑–ø–µ—á–Ω–æ!`,"success")),this.controller.world.getBush(e,t)&&(this.controller.world.checkBushTrap(e,t)?this.renderer.addLog("üåø –ö—É—â –ø–µ—Ä–µ–¥ —è–∫–∏–º —Å—Ç–æ—ó—Ç—å –ª–∏—Å–∏—Ü—è! –°–∫—Ä—É—Ç—ñ—Ç—å—Å—è (C) —â–æ–± –±–µ–∑–ø–µ—á–Ω–æ –ø—Ä–æ–π—Ç–∏ —á–µ—Ä–µ–∑ –Ω—å–æ–≥–æ!","error"):this.renderer.addLog("üåø –í–∏ –ø—Ä–æ–π—à–ª–∏ —á–µ—Ä–µ–∑ –∫—É—â –±–µ–∑–ø–µ—á–Ω–æ.","info"))}checkWinCondition(){this.controller.hedgehog.score>=1e3&&!this.controller.isGameOver()&&(this.controller.gameOverFlag=!0,this.renderer.addLog("üéâ –í–∏ –∑—ñ–±—Ä–∞–ª–∏ 1000 –æ—á–æ–∫ —ó–∂—ñ! –ü–µ—Ä–µ–º–æ–≥–∞!","success"),setTimeout(()=>{this.ui.showGameOver(`üéâ –ü–µ—Ä–µ–º–æ–≥–∞! –ó—ñ–±—Ä–∞–Ω–æ 1000 –æ—á–æ–∫ —ó–∂—ñ! –†–∞—Ö—É–Ω–æ–∫: ${this.controller.hedgehog.score}`),setTimeout(()=>{this.controller.restart(y),this.ui.updateWorldPosition(this.controller.hedgehog.positionX,this.controller.hedgehog.positionY),this.updateUI()},3e3)},500))}handleCollectFood(){if(this.controller.isGameOver())return;this.controller.collectFood()?this.renderer.addLog("üçé –á–∂–∞ –∑—ñ–±—Ä–∞–Ω–∞!","success"):this.renderer.addLog("ü§∑ –¢—É—Ç –Ω–µ–º–∞—î —ó–∂—ñ –¥–ª—è –∑–±–æ—Ä—É.","info"),this.updateUI()}handleTalk(){if(this.controller.isGameOver())return;const e=this.controller.talkToNPC();e?(this.ui.showChat("npc",e.dialog,e.npc),setTimeout(()=>{this.ui.showChat("hedgehog","–î—è–∫—É—é –∑–∞ –ø–æ—Ä–∞–¥—É!")},1e3),e.warning?e.warning.isWarning?(this.renderer.addLog(`‚ö†Ô∏è ${e.npc}: ${e.dialog}`,"error"),e.warning.shouldCurl&&this.renderer.addLog(`‚ö†Ô∏è –û–±–æ–≤'—è–∑–∫–æ–≤–æ —Å–∫—Ä—É—Ç–∏—Å—å (C) –ø–µ—Ä–µ–¥ –∑—É—Å—Ç—Ä—ñ—á—á—é –∑ ${e.warning.predator.name} —â–æ–± –Ω–µ –ø–æ–º–µ—Ä—Ç–∏!`,"error")):(this.renderer.addLog(`üí¨ ${e.npc}: ${e.dialog}`,"success"),e.warning.shouldCurl||this.renderer.addLog(`‚úÖ –ú–æ–∂–Ω–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç–∏ –ø–æ–≤–∑ ${e.warning.predator.name} –±–µ–∑–ø–µ—á–Ω–æ!`,"success")):this.renderer.addLog(`üí¨ ${e.npc}: ${e.dialog}`,"info")):this.controller.hedgehog.canTalk()?this.renderer.addLog("ü§∑ –¢—É—Ç –Ω–µ–º–∞—î –Ω—ñ–∫–æ–≥–æ –¥–ª—è —Ä–æ–∑–º–æ–≤–∏.","info"):this.renderer.addLog("‚ùå –ù–µ –º–æ–∂–Ω–∞ –≥–æ–≤–æ—Ä–∏—Ç–∏ —É –∑–≥–æ—Ä–Ω—É—Ç–æ–º—É —Å—Ç–∞–Ω—ñ!","error"),this.updateUI()}handleCurl(){this.controller.isGameOver()||(this.controller.curlHedgehog(),this.updateUI())}handleUncurl(){this.controller.isGameOver()||(this.controller.uncurlHedgehog(),this.updateUI())}handleRestart(){if(this.controller.lives>0){if(this.controller.lives-=1,this.controller.lives=Math.max(0,this.controller.lives),this.controller.lives<=0){const s=this.controller.getGameState().hedgehog.score;this.ui.showGameOver(`üíÄ –í–∏ –ø—Ä–æ–≥—Ä–∞–ª–∏ –æ—Å—Ç–∞—Ç–æ—á–Ω–æ! –†–∞—Ö—É–Ω–æ–∫: ${s}`),this.renderer.addLog(`‚ò†Ô∏è –í–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–ª–∏ –≤—Å—ñ –∂–∏—Ç—Ç—è! –§—ñ–Ω–∞–ª—å–Ω–∏–π —Ä–∞—Ö—É–Ω–æ–∫: ${s}`,"error");return}this.renderer.addLog(`üíî –í—Ç—Ä–∞—á–µ–Ω–æ –∂–∏—Ç—Ç—è! –ó–∞–ª–∏—à–∏–ª–æ—Å—å: ${this.controller.lives}`,"error")}else this.controller.lives=5,this.renderer.addLog("üîÑ –ù–æ–≤–∞ –≥—Ä–∞! –ñ–∏—Ç—Ç—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–æ –¥–æ 5","success");this.controller.restart(y),this.renderer.clearLog(),this.ui.hedgehogEl.classList.remove("walk","jump","fall","curled","moving","facing-left"),this.ui.hedgehogEl.classList.add("facing-right"),this.ui.updateCurledState(!1),this.ui.clearChat(),this.ui.initializeDecorations(),this.ui.initializeObjects(this.controller),this.ui.initializeHedgehog(),this.ui.worldTrack&&(this.ui.worldTrack.style.transform="translateX(0px)"),this.ui.updateWorldPosition(this.controller.hedgehog.positionX,this.controller.hedgehog.positionY),document.querySelectorAll("body > div:not(#app):not(script)").forEach(t=>t.remove()),this.updateUI(),this.renderer.addLog(`üîÑ –ù–æ–≤–∞ —Å–ø—Ä–æ–±–∞! –ñ–∏—Ç—Ç—è: ${this.controller.lives}`,"success"),this.stopPredatorMovement(),this.startPredatorMovement()}handleGameOver(e=!1){this.updateUI();const s=this.controller.getGameState().hedgehog.score;this.controller.hedgehog.isAlive()?(this.ui.showGameOver(`‚è±Ô∏è –ß–∞—Å –∑–∞–∫—ñ–Ω—á–∏–≤—Å—è! –†–∞—Ö—É–Ω–æ–∫: ${s}`),this.renderer.addLog(`üèÅ –ì—Ä—É –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –§—ñ–Ω–∞–ª—å–Ω–∏–π —Ä–∞—Ö—É–Ω–æ–∫: ${s}`,"info")):e?(this.controller.lives>0&&(this.controller.lives-=1,this.controller.lives=Math.max(0,this.controller.lives)),this.ui.updateLives(this.controller.lives),this.controller.lives<=0?(this.ui.showGameOver(`üíÄ –í–∏ –ø—Ä–æ–≥—Ä–∞–ª–∏ –æ—Å—Ç–∞—Ç–æ—á–Ω–æ! –†–∞—Ö—É–Ω–æ–∫: ${s}`),this.renderer.addLog(`‚ò†Ô∏è –í–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–ª–∏ –≤—Å—ñ –∂–∏—Ç—Ç—è! –§—ñ–Ω–∞–ª—å–Ω–∏–π —Ä–∞—Ö—É–Ω–æ–∫: ${s}`,"error")):(this.renderer.addLog(`üíî –í—Ç—Ä–∞—á–µ–Ω–æ –∂–∏—Ç—Ç—è! –ó–∞–ª–∏—à–∏–ª–æ—Å—å: ${this.controller.lives}`,"error"),setTimeout(()=>{this.handleRestart()},1e3))):e||(this.ui.showGameOver(`üíÄ –ì—Ä—É –ø—Ä–æ–≥—Ä–∞–Ω–æ! –†–∞—Ö—É–Ω–æ–∫: ${s}`),this.renderer.addLog(`‚ò†Ô∏è –ì—Ä—É –ø—Ä–æ–≥—Ä–∞–Ω–æ! –§—ñ–Ω–∞–ª—å–Ω–∏–π —Ä–∞—Ö—É–Ω–æ–∫: ${s}`,"error"))}updateUI(){const e=this.controller.getGameState();this.renderer.render(e),this.ui.updateEnergyBar(e.hedgehog.energy),this.ui.updateLives(e.lives),this.ui.updatePredatorPositions(this.controller.world),this.ui.syncFoodObjects(this.controller.world)}}new te;
